<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Python 分发站 — 专业下载（单文件）</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
<!-- JSZip for real zip packaging -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<style>
  :root{
    /* 基础（淡色、稳重） */
    --bg:#fff7ec;
    --card:#fffaf4;
    --muted:#5b6670;
    --accent:#f57c00;     /* 稍柔和的橙色 */
    --win-gloss: linear-gradient(180deg,#fff7ec,#ffe0b2);
    --btn-glass: linear-gradient(180deg,rgba(245,124,0,0.9),rgba(255,190,80,0.6));
    --radius:10px;
    --shadow: 0 8px 24px rgba(16,24,32,0.06);
    --mono:'Roboto Mono', monospace;
    --ui:'Inter',system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  }

  /* 更强的玻璃默认样式（主题切换时会覆盖变量） */
  body{margin:0;font-family:var(--ui);background:linear-gradient(180deg,var(--bg), #fff);color:#0b1220;-webkit-font-smoothing:antialiased;transition:background 0.28s, color 0.28s;}
  .container{max-width:980px;margin:34px auto;padding:20px}
  header{display:flex;align-items:center;gap:16px;background:var(--win-gloss);padding:14px;border-radius:14px;box-shadow:var(--shadow);border:1px solid rgba(8,18,40,0.06);transition:background 0.28s, box-shadow 0.28s;}
  .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#ffb300);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:2rem;}
  .title h1{margin:0;font-size:18px}
  .title p{margin:4px 0 0;color:var(--muted);font-size:13px}
  .tools{margin-left:auto;display:flex;gap:10px;align-items:center}
  /* 按钮：保持玻璃感但不眩目 */
  .btn {
    display:inline-flex;align-items:center;gap:8px;padding:8px 14px;border-radius:8px;
    background:linear-gradient(180deg,rgba(255,255,255,0.85),rgba(255,255,255,0.6));
    border:1px solid rgba(11,20,40,0.06);
    color:#0b1220;font-weight:600;cursor:pointer;transition:all .12s ease,font-size .12s;font-size:14px;
    box-shadow: 0 1px 0 rgba(255,255,255,0.55) inset;
    backdrop-filter: blur(6px) saturate(1.05);
  }
  .btn.primary{
    background:var(--btn-glass);
    color:#fff;
    border-color:rgba(0,0,0,0.06);
    box-shadow:0 10px 24px rgba(245,124,0,0.10);
  }
  .btn.ghost{background:transparent;border:1px solid rgba(11,20,40,0.06)}
  .btn:active{transform:translateY(1px);opacity:0.96}
  .controls{display:flex;gap:10px;align-items:center;margin-top:14px}
  .search{flex:1;display:flex;gap:8px;align-items:center}
  input[type="search"]{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(8,18,40,0.06);background:var(--card);font-size:14px}
  select{padding:9px;border-radius:10px;border:1px solid rgba(8,18,40,0.06);background:var(--card);font-size:14px}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-top:18px}
  @media(max-width:820px){.grid{grid-template-columns:1fr}}
  .card{background:var(--card);border-radius:12px;padding:14px;border:1px solid rgba(8,18,40,0.04);box-shadow:0 8px 20px rgba(16,24,32,0.04);display:flex;flex-direction:column;min-height:140px;transition:background 0.22s, box-shadow 0.22s;}
  .meta{display:flex;align-items:center;gap:12px}
  .tag{background:linear-gradient(180deg,#fff3e0,#ffe0b2);padding:6px 8px;border-radius:8px;font-weight:700;color:var(--accent);font-size:13px;border:1px solid rgba(255,152,0,0.06)}
  .name{font-weight:700;margin:0;font-size:15px}
  .desc{color:var(--muted);font-size:13px;margin:8px 0 0}
  .foot{display:flex;align-items:center;margin-top:auto;gap:10px}
  .pill{font-family:var(--mono);background:#fff3e0;padding:6px 8px;border-radius:8px;font-size:12px;color:#b26a00}
  .small{color:var(--muted);font-size:13px}
  .card .actions{margin-left:auto;display:flex;gap:8px}
  .count{font-size:12px;color:#b26a00}
  .modal-wrap{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(6,12,20,0.45);z-index:1200}
  .modal{width:92%;max-width:980px;border-radius:12px;padding:14px;background:linear-gradient(180deg,#fffaf4,#fff3e0);color:#6d4c00;box-shadow:0 20px 80px rgba(16,24,32,0.18);transition:background 0.22s;}
  pre{background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;overflow:auto;font-family:var(--mono);font-size:13px;max-height:62vh}
  .modal .meta{display:flex;align-items:center;gap:12px;margin-bottom:8px}
  .close{margin-left:auto;background:transparent;border:1px solid rgba(255,152,0,0.16);padding:8px;border-radius:8px;color:#ff9800;cursor:pointer}
  .copy-toast{position:fixed;right:22px;bottom:22px;background:#ff9800;color:#fff;padding:10px 14px;border-radius:10px;box-shadow:0 8px 30px rgba(255,152,0,0.22);display:none}
  footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}

  /* 玻璃主题样式（更强背板模糊、更透明、更明显玻璃感） */
  body.glass-theme{
    --bg: rgba(255,255,255,0.10);
    --card: rgba(255,255,255,0.08);
    --win-gloss: linear-gradient(180deg,rgba(255,255,255,0.30),rgba(255,255,255,0.06));
    --btn-glass: linear-gradient(180deg,rgba(245,124,0,0.7),rgba(255,190,80,0.36));
    --muted: rgba(80,86,92,0.9);
    --shadow: 0 12px 34px rgba(8,12,20,0.08);
  }
  body.glass-theme,
  body.glass-theme .container,
  body.glass-theme header,
  body.glass-theme .card,
  body.glass-theme .modal {
    background: var(--card)!important;
    backdrop-filter: blur(18px) saturate(1.25);
    -webkit-backdrop-filter: blur(18px) saturate(1.25);
    border:1px solid rgba(255,255,255,0.06);
  }
  body.glass-theme .btn.primary {
    background: var(--btn-glass)!important;
    color:#fff;
    border-color:rgba(255,152,0,0.12);
    box-shadow:0 12px 30px rgba(245,124,0,0.12);
  }
  body.glass-theme .btn {
    background:linear-gradient(180deg,rgba(255,255,255,0.6),rgba(255,255,255,0.2));
    color:#3b3b3b;
    border:1px solid rgba(255,255,255,0.06);
  }
  body.glass-theme .pill { background:rgba(255,224,178,0.18); color:#b26a00; }
  body.glass-theme .tag { background:linear-gradient(180deg,rgba(255,243,224,0.65),rgba(255,224,178,0.25)); color:var(--accent); border:1px solid rgba(255,152,0,0.06); }

  /* 主题选择控件 */
  .theme-controls{display:flex;gap:8px;align-items:center}
  .theme-swatch{width:28px;height:28px;border-radius:6px;border:1px solid rgba(0,0,0,0.06);cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,0.06)}
  .theme-swatch[data-theme="orange"]{background:linear-gradient(135deg,#f57c00,#ffb300)}
  .theme-swatch[data-theme="blue"]{background:linear-gradient(135deg,#1976d2,#64b5f6)}
  .theme-swatch[data-theme="green"]{background:linear-gradient(135deg,#2e7d32,#66bb6a)}
  .theme-swatch[data-theme="purple"]{background:linear-gradient(135deg,#8e24aa,#b39ddb)}
  .theme-swatch:focus{outline:2px solid rgba(0,0,0,0.06)}
  /* 管理面板样式 */
  .admin-panel{position:fixed;right:20px;top:90px;width:340px;background:var(--card);border-radius:10px;padding:12px;box-shadow:0 12px 40px rgba(8,12,20,0.12);z-index:1300;display:none}
  .admin-panel h3{margin:0 0 8px 0;font-size:15px}
  .admin-row{display:flex;gap:8px;margin-bottom:8px}
  .admin-row input[type="text"], .admin-row select, .admin-row textarea{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(8,18,40,0.06);background:var(--card)}
  .admin-list{max-height:220px;overflow:auto;border-top:1px dashed rgba(0,0,0,0.04);padding-top:8px;margin-top:8px}
  .admin-item{display:flex;justify-content:space-between;gap:8px;padding:6px;border-radius:6px}
  .danger{background:#fff1f0;border-color:#ffb4b4;color:#bf2600}
  .muted-note{font-size:12px;color:var(--muted);margin-top:6px}
</style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">Py</div>
      <div class="title">
        <h1>Python 分发站 · 专业下载</h1>
        <p>融合 Windows7 手感、Apple 质感与开发者友好，单文件静态页面分发脚本/安装包。</p>
      </div>
      <div class="tools" role="toolbar" aria-label="site tools">
        <button class="btn primary" id="downloadAllBtn">下载全部 (zip)</button>
        <button class="btn" id="refreshBtn">刷新列表</button>
        <button class="btn ghost" id="readmeBtn">说明</button>

        <!-- 主题色块与玻璃切换 -->
        <div class="theme-controls" title="主题切换">
          <div tabindex="0" class="theme-swatch" data-theme="orange" aria-label="橙色主题"></div>
          <div tabindex="0" class="theme-swatch" data-theme="blue" aria-label="蓝色主题"></div>
          <div tabindex="0" class="theme-swatch" data-theme="green" aria-label="绿色主题"></div>
          <div tabindex="0" class="theme-swatch" data-theme="purple" aria-label="紫色主题"></div>
          <button class="btn ghost" id="glassToggle" title="切换玻璃/普通">玻璃</button>
        </div>

        <button class="btn ghost" id="adminBtn" title="管理员登录">管理员</button>
      </div>
    </header>

    <div class="controls">
      <div class="search">
        <input type="search" id="search" placeholder="搜索文件名、描述或平台（回车搜索）" />
      </div>
      <select id="filter">
        <option value="all">全部类型</option>
        <option value="script">脚本 (.py)</option>
        <option value="binary">二进制/安装包</option>
      </select>
      <select id="sort">
        <option value="name">按名称</option>
        <option value="size">按大小</option>
        <option value="downloads">按下载量</option>
      </select>
    </div>

    <main class="grid" id="grid" aria-live="polite"></main>

    <footer>将此文件放到静态主机或 GitHub Pages。若需要真实二进制分发，请替换文件 url 指向实际文件。</footer>
  </div>

  <!-- modal preview -->
  <div class="modal-wrap" id="modal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modTitle">
      <div class="meta">
        <div>
          <strong id="modTitle">预览</strong>
          <span id="modName" class="pill" style="margin-left:8px"></span>
        </div>
        <div style="margin-left:auto;display:flex;gap:8px">
          <button class="btn" id="modDownload">下载</button>
          <button class="btn" id="modCopy">复制</button>
          <button class="close" id="modClose">关闭</button>
        </div>
      </div>
      <pre id="modContent" tabindex="0"></pre>
    </div>
  </div>

  <div class="copy-toast" id="toast">已复制到剪贴板</div>

  <!-- 管理面板（客户端实现，数据保存在 localStorage）-->
  <div class="admin-panel" id="adminPanel" aria-hidden="true">
    <h3>管理员面板</h3>
    <div class="admin-row">
      <input type="text" id="a_name" placeholder="文件名（含扩展名）" />
    </div>
    <div class="admin-row">
      <select id="a_type">
        <option value="script">script</option>
        <option value="binary">binary</option>
      </select>
      <input type="text" id="a_platform" placeholder="平台（如 Windows/Linux）" />
    </div>
    <div class="admin-row">
      <input type="text" id="a_desc" placeholder="描述" />
    </div>
    <div class="admin-row">
      <input type="file" id="a_file" />
    </div>
    <div class="admin-row">
      <textarea id="a_content" placeholder="或直接粘贴源代码 / 内容" rows="6"></textarea>
    </div>
    <div style="display:flex;gap:8px">
      <button class="btn primary" id="a_save">保存并上架</button>
      <button class="btn" id="a_import">导出用户上传(zip)</button>
      <button class="btn ghost" id="a_close">关闭</button>
    </div>
    <div class="muted-note">说明：管理员密码在客户端验证（不安全）。上传内容将保存在本地浏览器 localStorage 中，适合小型部署或演示。若想长期保存到服务器，请接入后端或 GitHub API。</div>
    <div class="admin-list" id="adminList"></div>
  </div>

<script>
/* ---------------------- 数据源与持久化 ---------------------- */

/* 原始内置文件（保持和原始页面一致） */
const DEFAULT_FILES = [
  {
    name: "绿梵AI.py",
    type: "script",
    platform: "Windows/Linux/macOS",
    desc: "tkinter + selenium 自动化聊天脚本（含 webdriver 管理示例）。",
    content: `import tkinter as tk
from tkinter import ttk
from selenium import webdriver  # 控制浏览器的核心模块
from selenium.webdriver.chrome.service import Service  # 管理ChromDriver服务
from webdriver_manager.chrome import ChromeDriverManager  # 自动下载并管理ChromeDriver
from selenium.webdriver.common.by import By  # 定义元素定位方式
from selenium.webdriver.support.ui import WebDriverWait  # 显示等待工具
from selenium.webdriver.support import expected_conditions as EC  # 常用等待条件
import time

import threading
from selenium.webdriver.common.keys import Keys

main_版本 = '1.0.0'
green_f = tk.Tk()
green_f.title(f'绿梵AI [{main_版本}]')
green_f.geometry('344x250')

Label1 = tk.Label(green_f, text='初始化进程', font=('微软雅黑 Light', 17))
Label1.place(x=20, y=25)
Label2 = tk.Label(green_f, text='输入来自Google Chrame浏览器的地址', font=('微软雅黑', 13))
Label2.place(x=20, y=65)
entry1 = ttk.Entry(green_f, font=('微软雅黑', 13))
entry1.place(x=20, y=145, height=32, width=220)
style = ttk.Style()
style.configure('TButton', font=('微软雅黑', 13), height=32, width=7)
place = ''
版本 = ''
顺序 = 0
word=''

def main():
   try:
    global place, 版本, driver
    green_AIf = tk.Tk()

    def mu1():
        green_AIf.geometry('344x250')
        txt_edit.config(height=7,width=33)
        entry3.place(x=22,y=175,width=250,height=46)
        btnT.place(x=275,y=175,height=48,width=48)

    def mu2():
        green_AIf.geometry('544x450')
        txt_edit.config(height=18,width=55)
        entry3.place(x=22,y=390,width=445,height=52)
        btnT.place(x=471,y=390,height=53,width=51)
    def mu3():
        green_AIf.geometry('744x650')
        txt_edit.config(height=27,width=77)
        entry3.place(x=22,y=573,width=635,height=56)
        btnT.place(x=661,y=573,height=57,width=57)


    green_AIf.title(f'绿梵AI [{main_版本}]')
    entry3 = ttk.Entry(green_AIf, font=('微软雅黑', 13))
    entry3.place(x=22, y=175, height=46, width=250)
    txt_edit = tk.Text(green_AIf, wrap=tk.WORD, width=33, font=('微软雅黑', 11), height=7, undo=True)
    txt_edit.place(x=22, y=13)


    txt_edit.config(state=tk.NORMAL)
    txt_edit.delete('1.0', tk.END)
    txt_edit.config(state='disabled')
    # 创建Scrollbar组件

    scrollbar = tk.Scrollbar(green_AIf, orient=tk.VERTICAL, command=txt_edit.yview)
    scrollbar.pack(side=tk.RIGHT, fill=tk.Y)

    # 配置Text组件与Scrollbar的关系
    txt_edit['yscrollcommand'] = scrollbar.set
    chat_控制=0
    chat_net_顺序=1
    chat_版本='DeepSeek-R1'
    def chat(value):
            nonlocal chat_版本
            # 点击思考部分按钮，使思考的部分也显示出来
            try:



                button = driver.find_element(By.CSS_SELECTOR, "[class*='cos-icon cos-icon-change']")
                button.click()
                wait = WebDriverWait(driver, 10)


                # 定位所有class为"input-capsules-model-list-item"的元素
                all_items = wait.until(
                  EC.presence_of_all_elements_located(
                      (By.CLASS_NAME, "input-capsules-model-list-item")
                  )
                )

                # 遍历元素寻找目标按钮
                for item in all_items:
                  # 检查元素内是否包含"DeepSeek-V3最新版"标题
                  title_element = item.find_element(
                      By.CLASS_NAME, "input-capsules-model-list-item-title"
                  )
                  print('value'+str(value))
                  
                  版本=chat_版本
                  print('版本'+str(版本))
                  if title_element.text == value:

                      # 点击目标按钮
                      item.click()
                      print(f"成功点击{value}")
                      chat_版本=value
                      button = driver.find_element(By.CSS_SELECTOR, "[class*='cos-icon cos-icon-change']")
                      button.click()
                      break


                版本_List=['DeepSeek-R1','DeepSeek-V3']
                for i in range(len(版本_List)):
                  print(i)
                  if(版本_List[i]==版本):
                     file_menu2.entryconfig(i, label=f"${'{' }版本_List[i]}")
                     print(str(版本)+f'    版本1    {i}')
                     print(str(版本_List[i])+'     版本_List1')

                  if(value==版本_List[i]):
                     file_menu2.entryconfig(i, label=f"${'{' }版本_List[i]} √")
                     print(str(value)+f'    版本2     {i}')
                     print(str(版本_List[i])+'     版本_List2')

            except Exception as e:
                      print(f'Error:\\n{e}')



    def net():
       nonlocal chat_net_顺序
       try:
            button = driver.find_element(By.CSS_SELECTOR,"[class*='cos-icon cos-icon-change']")
            button.click()
            button = driver.find_element(By.CSS_SELECTOR, "[class*='cos-switcher cos-sm']")
            button.click()
            chat_net_顺序+=1
            if(chat_net_顺序%2!=0):

               file_menu2.entryconfig(3, label="联网模式")
            else:
              file_menu2.entryconfig(3, label="联网模式 √")
            button = driver.find_element(By.CSS_SELECTOR, "[class*='cos-icon cos-icon-change']")
            button.click()
       except Exception as e:

            print(f'Error:\\n{e}')
            pass


    def exchange():
        global word
        nonlocal chat_控制
        try:
            try:
                txt_edit.config(state='normal')
                btnT.config(state='disabled')

                entry3.delete(0, tk.END)

                #刷新网页
                #driver.refresh()
                chat_控制=1
                ok()
            except Exception as e:
                txt_edit.insert(tk.END,f'无法重新回复，请稍后重试 \\n{e}')
                green_AIf.update()
            finally:
                txt_edit.config(state='normal')
                btnT.config(state='disabled')
                green_AIf.update()


        except Exception as e:
            txt_edit.insert(tk.END,f'无法重新回复，请稍后重试 \\n{e}')
            green_AIf.update()
        finally:
            btnT.config(state='normal')
            txt_edit.config(state='disabled')
            chat_控制=0
    chat_thought_顺序=1
    def thought():
       nonlocal chat_thought_顺序
       try:
          button = driver.find_element(By.CSS_SELECTOR,"[class*='internet-search-icon']")
          button.click()
          chat_thought_顺序+=1
          if(chat_thought_顺序%2!=0):

            file_menu2.entryconfig(5, label="深度思考")
          else:
           file_menu2.entryconfig(5, label="深度思考 √")
       except Exception as e:
          print(f'{e}')


    # 创建菜单栏
    menu_bar = tk.Menu(green_AIf)
    # 文件菜单
    file_menu = tk.Menu(menu_bar, tearoff=0)
    file_menu2 = tk.Menu(menu_bar, tearoff=0)
    file_menu3 = tk.Menu(menu_bar, tearoff=0)
    file_menu.add_command(label="🗘 重新回复", command=exchange)


    file_menu2.add_command(label="DeepSeek-R1 √", command=lambda x='DeepSeek-R1': chat(x))
    file_menu2.add_command(label="DeepSeek-V3",  command=lambda x='DeepSeek-V3': chat(x))


    file_menu2.add_separator()
    file_menu2.add_command(label="联网模式", command=net)

    file_menu2.add_separator()
    file_menu2.add_command(label="深度搜索", command=thought)


    file_menu3.add_command(label="344x250", command=mu1)
    file_menu3.add_command(label="644x450", command=mu2)
    file_menu3.add_command(label="744x650", command=mu3)


    file_menu.entryconfig('🗘 重新回复',  state='disabled')
    menu_bar.add_cascade(label="编辑", menu=file_menu)
    menu_bar.add_cascade(label="版本", menu=file_menu2)
    menu_bar.add_cascade(label="窗口", menu=file_menu3)


    # 设置菜单栏到窗口
    green_AIf.config(menu=menu_bar)







    ok_次=0
    def ok_son():
        nonlocal entry3,chat_控制,ok_次
        global driver,word
        try:
            if(chat_控制)==0:
               word = entry3.get()
            print(chat_控制)
            if word == '':
                txt_edit.config(state='disabled')
                btnT.config(state='normal')
                return
            
            # 访问网址

            if chat_控制==0:
                print(1)
                txt_edit.config(state='normal')
                btnT.config(state='disabled')
                
                #txt_edit.delete('1.0', tk.END)
                txt_edit.insert(tk.END, f'我提出的问题:\\n{word}\\n\\n')
            else:
                txt_edit.config(state='normal')
                btnT.config(state='disabled')
                txt_edit.insert(tk.END,'\\n\\n重新回答:\\n')
            txt_edit.config(state='normal')
            btnT.config(state='disabled')

            entry3.delete(0, tk.END)


            #使用after能解决无响应问题

            green_AIf.update()

            # 👇 关键：对 word 进行 URL 编码（写网址的时候可用）
            ##                from urllib.parse import quote
            ##                word = quote(word, safe='')
            ##                url = f'https://chat.baidu.com/search?word={word}。&dyTabStr=MCwxMiwzLDEsMiwxMyw3LDYsNSw5&pd=csaitab&setype=csaitab&extParamsJson=%7B%22enter_type%22%3A%22search_a_tab%2[...]
            ##
            ##                # 插入文本内容
            ##                txt_edit.insert(tk.END, f'正在访问:{url}\\n')
            txt_edit.insert(tk.END, f'正在写入:{word}\\n')
            # 定位输入框元素（支持多种定位方式)
            ok_次+=1
            if(ok_次==1):
               input_element = driver.find_element(By.ID,"chat-textarea")  # 通过ID定位
            else:
               input_element = driver.find_element(By.ID,"chat-input-box")
            # input_element = driver.find_element_by_name("q")  # 通过name属性定位
            # input_element = driver.find_element_by_xpath("//input[@class='search']")  # 通过XPath定位
            print('检测OK')
            # 在输入框中输入文字
            input_element.send_keys(word)
            print('输入OK')
            # 模拟回车键提交
            input_element.send_keys(Keys.RETURN)                # 刷新让其显示
            green_AIf.update()
            print('回撤OK')
            #driver.get(url)  # 打开网页



            try:
                txt_edit.insert(tk.END, f'思考中~\\n')
                green_AIf.update()
                # 等待第一个AI段落出现
                try:
                    WebDriverWait(driver,25, 0.3).until(
                        # 使用稳定的选择器
                        # class=这种最精确，不是只要包含这个元素名就行
                        EC.presence_of_element_located((By.CSS_SELECTOR, "[class*='marklang-paragraph']"))

                    )
                except:
                    if(chat_控制!=0):
                       txt_edit.insert(tk.END, f'窗口莫名出现了问题，请重新进入~\\n')
                       return
                    else:
                       txt_edit.insert(tk.END, f'窗口莫名出现了问题，正在重试~\\n')

                       green_AIf.update()
                       exchange()
                    

                txt_edit.insert(tk.END, f'正在组织回答~\\n')
                green_AIf.update()

                # 等待至少2个段落出现（确保其内容完整，避免遗漏）使用最强大的python选择器
                WebDriverWait(driver, 180, 0.3).until(
                    lambda d: len(d.find_elements(By.CSS_SELECTOR, "[class*='marklang']")) >= 1

                )
            except Exception as e:
                txt_edit.insert(tk.END, f'错误,请重试~\\n{e}\\n')
                green_AIf.update()
                return


            # 检查是否全部生成出来
            try:

                WebDriverWait(driver, 180, 0.3).until(
                    #until只能有一个等待值但是any_of/all_of可以有多个
                   EC.all_of(
                        # 使用稳定的选择器
                        # class=这种最精确，不是只要包含这个元素名就行
                        # class*=这种只要部分达标即可可以防止因网页代码更新造成的错误
                        EC.presence_of_element_located((By.CSS_SELECTOR, "[class*='cos-icon cos-icon-thumbs-down']")),
                        EC.presence_of_element_located((By.CSS_SELECTOR, "[class*='cos-icon cos-icon-exchange']")),
                        EC.presence_of_element_located((By.CSS_SELECTOR, "[class*='cos-icon cos-icon-thumbs-up']"))
                   )
                )
            except Exception as e:
                txt_edit.insert(tk.END, f'系统超时~\\n{e}\\n')
                green_AIf.update()
            txt_edit.insert(tk.END, f'即将生成回复~\\n')
            green_AIf.update()

            time.sleep(1.5)  # 给 JavaScript 留出时间完成渲染


            # 滚动到底部，触发所有内容渲染
            driver.execute_script("window.scrollTo(0, document.body.scrollHeight);")
            time.sleep(1.5)
            # 点击思考部分按钮，使思考的部分也显示出来
            try:
                button = driver.find_element(By.CSS_SELECTOR, "[class*='cos-icon cos-icon-down']")
                button.click()
            except:
                print('无思考进程~')
            # 使用 Selenium 直接查找所有 AI 段落
            paragraphs = driver.find_elements(By.CSS_SELECTOR, "[class*='marklang-paragraph']")
           # print(len(driver.find_elements(By.CSS_SELECTOR, "[class='marklang']")))

            # 遍历并输出每一段内容

            for i, p in enumerate(paragraphs, 0):
                try:
                    # 实时找最新的元素
                    p = driver.find_elements(By.CSS_SELECTOR, "[class*='marklang-paragraph']")[i]
                    text = p.text.strip()  # 去除首尾空白字符
                    if text:  # 避免输出空段落
                        txt_edit.insert(tk.END, f'{text}\\n')
                        green_AIf.update()
                except Exception as e:
                    txt_edit.insert(tk.END, f'发生错误:{e}\\n')
                    green_AIf.update()
                else:
                    file_menu.entryconfig('🗘 重新回复',  state='normal')
        except Exception as e:
            txt_edit.insert(tk.END, f'发生错误:{e}\\n')
            green_AIf.update()
        finally:
            # 释放内存和系统资源
            chat_控制=0
            txt_edit.insert(tk.END, f'回答已结束~\\n\\n\\n')
            btnT.config(state='normal')
            file_menu.entryconfig('🗘 重新回复',  state='normal')
            txt_edit.config(state='disabled')
            green_AIf.update()

    ##
    def close():
        # print(1)
        try:
            driver.quit()
            green_AIf.destroy()
        except:
            pass
    def ok():
      threading.Thread(target=ok_son, daemon=True).start()
    # 绑定窗口关闭事件到自定义函数
    green_AIf.protocol("WM_DELETE_WINDOW", close)

    btnT = ttk.Button(green_AIf, style='TButton', text='''发送''', command=ok)
    btnT.place(x=275, y=175, height=48, width=48)
    mu1()
    green_AIf.mainloop()
   except Exception as e:
       print(f'Error:{e}')`
  },
  {
    name: "非爬取方式.py",
    type: "script",
    platform: "Cross-platform",
    desc: "轻量的关键字匹配本地问答脚本，适合离线测试与示例。",
    content: `import time
import random

# 用户自定义问答库（可以不断扩展）
qa_library = {
    "你好": ["你好呀！", "您好，有什么想问的？"],
    "你是谁": ["我是一个用Python做的简易AI助手。"],
    "时间": [lambda: "现在时间是：" + time.strftime("%Y-%m-%d %H:%M:%S", time.localtime())],
    "日期": [lambda: "今天是：" + time.strftime("%Y-%m-%d", time.localtime())],
    "天气": ["今天天气不错！", "天气晴朗，适合学习Python！"],
    "帮助": ["你可以问我：你好、时间、计算、天气、历史等问题。"]
}

# 对话历史
history = []

def simple_math(sentence):
    # 支持加法、减法、乘法、除法
    try:
        expression = sentence.replace('加', '+').replace('减', '-').replace('乘', '*').replace('除', '/')
        result = eval(expression)
        return f"计算结果是：{result}"
    except:
        return "抱歉，目前只支持简单的加减乘除运算。"

def ai_answer(user_input):
    user_input = user_input.strip().lower()
    # 关键词匹配
    for key in qa_library:
        if key in user_input:
            answer = random.choice(qa_library[key])
            if callable(answer):
                return answer()
            return answer
    # 数学计算
    if any(op in user_input for op in ['加', '减', '乘', '除', '+', '-', '*', '/']):
        return simple_math(user_input)
    # 时间和日期
    if "几点" in user_input or "时间" in user_input:
        return time.strftime("%Y-%m-%d %H:%M:%S", time.localtime())
    if "日期" in user_input or "今天" in user_input:
        return time.strftime("%Y-%m-%d", time.localtime())
    # 输出历史
    if "历史" in user_input or "对话" in user_input:
        return "历史对话：" + "; ".join(history[-5:])
    # 默认回答
    return "抱歉，我还不太懂你的问题，可以问我时间、计算、天气、历史等~"

if __name__ == "__main__":
    print("欢迎体验Python简易AI助手！（输入 exit 结束）")
    while True:
        user_input = input("你说：")
        if user_input.lower() in ("exit", "quit", "bye"):
            print("AI助手：再见！")
            break
        history.append(user_input)
        print("AI助手：", ai_answer(user_input))`
  }
];

/* 尝试从 localStorage 恢复用户上传条目 */
function loadUserFiles(){
  try{
    const raw = localStorage.getItem('user_files');
    if(!raw) return [];
    const arr = JSON.parse(raw);
    if(Array.isArray(arr)) return arr;
  }catch(e){}
  return [];
}
function saveUserFiles(list){
  try{
    localStorage.setItem('user_files', JSON.stringify(list));
    return true;
  }catch(e){ return false; }
}

/* 合并默认与用户文件；用户文件优先 */
let FILES = [];
function initFiles(){
  const users = loadUserFiles();
  // basic dedupe by name
  const map = {};
  DEFAULT_FILES.concat(users).forEach(f=>{
    map[f.name] = f;
  });
  FILES = Object.values(map);
}

/* ---------------------- 小工具 ---------------------- */
const $ = sel => document.querySelector(sel);
const g = id => document.getElementById(id);

async function sha1Hex(str){
  const buf = new TextEncoder().encode(str);
  const hash = await crypto.subtle.digest('SHA-1', buf);
  return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,'0')).join('');
}

/* 下载统计保存在 localStorage */
function getCounts(){ try { return JSON.parse(localStorage.getItem('dl_counts')||'{}') } catch { return {} } }
function incCount(name){ const c=getCounts(); c[name]=(c[name]||0)+1; localStorage.setItem('dl_counts',JSON.stringify(c)); }

/* ---------------------- 渲染与交互 ---------------------- */

function makeCard(f, idx){
  const div = document.createElement('article');
  div.className='card';
  div.innerHTML = `
    <div class="meta">
      <div class="tag">${f.type.toUpperCase()}</div>
      <div style="flex:1">
        <p class="name">${escapeHtml(f.name)}</p>
        <div class="desc">${escapeHtml(f.desc)}</div>
        <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
          <span class="pill">${f.platform}</span>
          <span class="small" id="size-${idx}">计算大小…</span>
          <span class="count" id="count-${idx}"></span>
        </div>
      </div>
      <div class="actions">
        <button class="btn primary" data-download="${idx}">下载</button>
        <button class="btn" data-view="${idx}">预览</button>
      </div>
    </div>
  `;
  // size & count
  const sizeEl = div.querySelector(`#size-${idx}`);
  const countEl = div.querySelector(`#count-${idx}`);
  const blob = new Blob([f.content || ''], {type:'text/plain;charset=utf-8'});
  sizeEl.textContent = blob.size < 1024 ? `${blob.size} B` : `${(blob.size/1024).toFixed(1)} KB`;
  const counts = getCounts(); countEl.textContent = `下载 ${counts[f.name]||0} 次`;
  // handlers
  div.querySelector('[data-download]').onclick = ()=>downloadFile(idx);
  div.querySelector('[data-view]').onclick = ()=>openModal(idx);
  return div;
}

function render(list){
  const grid = g('grid');
  grid.innerHTML = '';
  list.forEach((f,i)=> grid.appendChild(makeCard(f,i)));
}

/* filtering & search & sort */
function applyFilters(){
  const q = g('search').value.trim().toLowerCase();
  const filter = g('filter').value;
  const sort = g('sort').value;
  let list = FILES.filter(f=>{
    if(filter!=='all' && f.type!==filter) return false;
    if(!q) return true;
    return (f.name+f.desc+f.platform).toLowerCase().includes(q);
  });
  if(sort==='name') list.sort((a,b)=>a.name.localeCompare(b.name));
  else if(sort==='size') list.sort((a,b)=> (new Blob([a.content || '']).size) - (new Blob([b.content || '']).size) );
  else if(sort==='downloads'){
    const counts = getCounts();
    list.sort((a,b)=>(counts[b.name]||0)-(counts[a.name]||0));
  }
  render(list);
}

/* download single (supports content or url) */
async function downloadFile(i){
  const f = FILES[i];
  incCount(f.name);
  applyFilters(); // update counts
  if(f.url){
    // external URL — direct navigate (good for large binaries)
    const a = document.createElement('a');
    a.href = f.url; a.download = f.name; document.body.appendChild(a); a.click(); a.remove();
    return;
  }
  const blob = new Blob([f.content || ''], {type: f.type==='script' ? 'text/x-python;charset=utf-8' : 'application/octet-stream'});
  // compute checksum async and show in console (nice-to-have)
  sha1Hex(f.content || '').then(h=> console.log(`${f.name} SHA1: ${h}`)).catch(()=>{});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = f.name; document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=>URL.revokeObjectURL(url),5000);
}

/* preview modal */
function openModal(i){
  const f = FILES[i];
  g('modName').textContent = f.name;
  g('modTitle').textContent = `${f.type.toUpperCase()} 预览`;
  g('modContent').textContent = f.content || '(无内容)';
  g('modal').style.display = 'flex';
  g('modDownload').onclick = ()=>downloadFile(i);
  g('modCopy').onclick = ()=>{ navigator.clipboard.writeText(f.content || '').then(()=>showToast()) };
}
g('modClose').onclick = ()=> g('modal').style.display='none';

/* zip all using JSZip */
async function downloadAll(){
  const zip = new JSZip();
  FILES.forEach(f=> zip.file(f.name, f.content || ''));
  const blob = await zip.generateAsync({type:'blob',compression:'DEFLATE'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'python-files.zip'; document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=>URL.revokeObjectURL(url),5000);
}

/* helpers */
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') }
function showToast(){ const t=g('toast'); t.style.display='block'; setTimeout(()=>t.style.display='none',1300) }

/* ---------------------- 事件绑定 ---------------------- */
g('search').addEventListener('keydown', e=>{ if(e.key==='Enter') applyFilters() });
g('filter').addEventListener('change', applyFilters);
g('sort').addEventListener('change', applyFilters);
g('downloadAllBtn').addEventListener('click', downloadAll);
g('refreshBtn').addEventListener('click', ()=>{ location.reload() });
g('readmeBtn').addEventListener('click', ()=> {
  // simple modal readme
  g('modName').textContent='说明';
  g('modTitle').textContent='站点说明';
  g('modContent').textContent = `说明：
- 点击“下载”会把内置内容另存为文件。
- 若要分发真实安装包，把对应条目替换为 { url: "https://your.host/path/to/file.exe" }，并把 content 留空或简短说明。
- 管理功能为客户端实现，输入管理员密码后可上架文件并将内容保存到浏览器 localStorage（仅在本机/同浏览器可见）。
- 若需长期、可公开存储，请接入后端或使用 GitHub API 提交文件到仓库。`;
  g('modal').style.display='flex';
  g('modDownload').onclick = ()=>{}; // noop
  g('modCopy').onclick = ()=>{ navigator.clipboard.writeText(g('modContent').textContent).then(()=>showToast()) };
});

/* keyboard ESC close modal */
document.addEventListener('keydown', e=>{ if(e.key==='Escape') g('modal').style.display='none' });

/* ---------------------- 主题逻辑 ---------------------- */
const THEMES = {
  orange: { '--accent':'#f57c00', '--btn-glass':'linear-gradient(180deg,rgba(245,124,0,0.9),rgba(255,190,80,0.6))' },
  blue:   { '--accent':'#1976d2', '--btn-glass':'linear-gradient(180deg,rgba(25,118,210,0.92),rgba(100,181,246,0.6))' },
  green:  { '--accent':'#2e7d32', '--btn-glass':'linear-gradient(180deg,rgba(46,125,50,0.92),rgba(102,187,106,0.6))' },
  purple: { '--accent':'#8e24aa', '--btn-glass':'linear-gradient(180deg,rgba(142,36,170,0.92),rgba(179,157,219,0.6))' }
};
function applyTheme(name){
  const theme = THEMES[name];
  if(!theme) return;
  Object.entries(theme).forEach(([k,v])=> document.documentElement.style.setProperty(k, v));
  // update logo gradient to match accent
  const accent = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();
  $('.logo').style.background = `linear-gradient(135deg, ${accent}, ${shadeColor(accent, 20)})`;
  // persist choice
  localStorage.setItem('site_theme', name);
}
function shadeColor(color, percent){ // accepts #rrggbb
  try{
    const c = color.replace('#','');
    const num = parseInt(c,16);
    const r = Math.min(255, Math.max(0, Math.floor(((num >> 16) & 0xFF) * (100+percent)/100)));
    const g2 = Math.min(255, Math.max(0, Math.floor(((num >> 8) & 0xFF) * (100+percent)/100)));
    const b = Math.min(255, Math.max(0, Math.floor(((num) & 0xFF) * (100+percent)/100)));
    return '#'+((1<<24)+(r<<16)+(g2<<8)+b).toString(16).slice(1);
  }catch(e){return color;}
}
document.querySelectorAll('.theme-swatch').forEach(s=>{
  s.addEventListener('click', ()=> {
    const t = s.getAttribute('data-theme');
    applyTheme(t);
  });
  s.addEventListener('keydown', e=> { if(e.key==='Enter' || e.key===' ') { e.preventDefault(); s.click(); }});
});
g('glassToggle').addEventListener('click', ()=>{
  document.body.classList.toggle('glass-theme');
  localStorage.setItem('glass_mode', document.body.classList.contains('glass-theme') ? '1' : '0');
});

/* restore theme from storage */
(function restoreTheme(){
  const t = localStorage.getItem('site_theme') || 'orange';
  applyTheme(t);
  if(localStorage.getItem('glass_mode')==='1') document.body.classList.add('glass-theme');
})();

/* ---------------------- 管理（客户端） ---------------------- */

/* 管理密码（客户端校验 — 注意：不可作为安全机制） */
const ADMIN_PASSWORD = 'lhm0627*';  // 按照用户要求实现（客户端校验，非安全）
function showPasswordPrompt(){
  const pwd = prompt('请输入管理员密码：');
  if(pwd === null) return;
  if(pwd === ADMIN_PASSWORD){
    sessionStorage.setItem('admin_auth','1');
    openAdminPanel();
  }else{
    alert('密码错误');
  }
}
g('adminBtn').addEventListener('click', showPasswordPrompt);

/* 管理面板行为 */
function openAdminPanel(){
  if(sessionStorage.getItem('admin_auth') !== '1'){ showPasswordPrompt(); return; }
  const panel = g('adminPanel');
  panel.style.display = 'block';
  panel.setAttribute('aria-hidden','false');
  refreshAdminList();
}
g('a_close').addEventListener('click', ()=>{ g('adminPanel').style.display='none'; g('adminPanel').setAttribute('aria-hidden','true'); });

/* 读取 file 输入并填充到 textarea */
g('a_file').addEventListener('change', async (e)=>{
  const f = e.target.files && e.target.files[0];
  if(!f) return;
  const isText = f.type.startsWith('text') || /\.(py|txt|md|json|js|html|css)$/i.test(f.name);
  if(isText){
    const txt = await f.text();
    g('a_content').value = txt;
    g('a_name').value = f.name;
  }else{
    // 二进制：读取为 base64
    const reader = new FileReader();
    reader.onload = ()=> {
      // store as base64 marker
      g('a_content').value = `__base64__:${reader.result.split(',')[1]}`;
      g('a_name').value = f.name;
      g('a_type').value = 'binary';
    };
    reader.readAsDataURL(f);
  }
});

/* 保存并上架 */
g('a_save').addEventListener('click', ()=>{
  const name = g('a_name').value.trim();
  const type = g('a_type').value;
  const platform = g('a_platform').value.trim() || 'Unknown';
  const desc = g('a_desc').value.trim() || '';
  let content = g('a_content').value || '';
  if(!name){
    alert('请填写文件名');
    return;
  }
  // 将 base64 marker 保留，下载时识别
  const users = loadUserFiles();
  // overwrite if same name
  const idx = users.findIndex(u=>u.name === name);
  const item = { name, type, platform, desc, content };
  if(idx>=0) users[idx] = item; else users.push(item);
  if(saveUserFiles(users)){
    alert('保存成功（保存在浏览器 localStorage）');
    initFiles();
    applyFilters();
    refreshAdminList();
    // clear inputs
    g('a_name').value=''; g('a_desc').value=''; g('a_content').value=''; g('a_file').value='';
  }else{
    alert('保存失败（localStorage 写入错误）');
  }
});

/* 导出用户上传为 zip */
g('a_import').addEventListener('click', async ()=>{
  const users = loadUserFiles();
  if(!users.length){ alert('没有用户上传内容'); return; }
  const zip = new JSZip();
  users.forEach(u=>{
    if(typeof u.content === 'string' && u.content.startsWith('__base64__:')){
      // base64 decode to binary
      const b64 = u.content.slice('__base64__:'.length);
      const byteChars = atob(b64);
      const byteNumbers = new Array(byteChars.length);
      for (let i = 0; i < byteChars.length; i++) byteNumbers[i] = byteChars.charCodeAt(i);
      const byteArray = new Uint8Array(byteNumbers);
      zip.file(u.name, byteArray);
    }else{
      zip.file(u.name, u.content || '');
    }
  });
  const blob = await zip.generateAsync({type:'blob', compression:'DEFLATE'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'user-uploads.zip'; document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=>URL.revokeObjectURL(url),5000);
});

/* 管理列表渲染 */
function refreshAdminList(){
  const list = g('adminList');
  const users = loadUserFiles();
  list.innerHTML = '';
  if(users.length === 0){ list.innerHTML = '<div class="muted-note">暂无用户上传文件</div>'; return; }
  users.forEach((u, i)=>{
    const div = document.createElement('div');
    div.className = 'admin-item';
    div.innerHTML = `<div style="flex:1"><strong>${escapeHtml(u.name)}</strong><div style="font-size:12px;color:var(--muted)">${escapeHtml(u.desc)}</div></div>
      <div style="display:flex;gap:6px">
        <button class="btn" data-load="${i}">加载</button>
        <button class="btn danger" data-del="${i}">删除</button>
      </div>`;
    list.appendChild(div);
    div.querySelector('[data-load]').onclick = ()=> {
      g('a_name').value = u.name;
      g('a_type').value = u.type;
      g('a_platform').value = u.platform;
      g('a_desc').value = u.desc;
      g('a_content').value = u.content || '';
    };
    div.querySelector('[data-del]').onclick = ()=> {
      if(!confirm('确认删除此用户上传并从 localStorage 中移除？')) return;
      users.splice(i,1);
      saveUserFiles(users);
      initFiles();
      applyFilters();
      refreshAdminList();
    };
  });
}

/* ---------------------- 初始化 ---------------------- */
initFiles();
applyFilters();

/* compute and attach SHA1 asynchronously and show in console for transparency */
FILES.forEach(f=> sha1Hex(f.content || '').then(h=> console.debug(`${f.name} SHA1: ${h}`)).catch(()=>{}));

</script>
</body>
</html>
